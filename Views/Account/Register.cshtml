@model GymQuest.Models.ViewModels.RegisterViewModel

@{
    ViewBag.Title = "User Registration";
}

<h1>User Registration</h1>

<div class="row">
    <div class="col-md-12">
        <form id="registerForm" method="post">
            <div asp-validation-summary="All" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="FirstName">First Name</label>
                <input asp-for="FirstName" class="form-control" />
                <span asp-validation-for="FirstName" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="LastName">Last Name</label>
                <input asp-for="LastName" class="form-control" />
                <span asp-validation-for="LastName" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Email"></label>
                <input asp-for="Email" class="form-control" />
                <span asp-validation-for="Email" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Password"></label>
                <input asp-for="Password" class="form-control" />
                <span asp-validation-for="Password" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="ConfirmPassword"></label>
                <input asp-for="ConfirmPassword" class="form-control" />
                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
            </div>
            <button type="submit" class="btn btn-primary">Register</button>
        </form>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            $('#registerForm').submit(function (event) {
                event.preventDefault(); // Prevent the default form submit

                // Check if form is valid before submitting via AJAX
                if ($(this).valid()) {
                    var formData = $(this).serialize(); // Get the form data

                    $.ajax({
                        url: '@Url.Action("Register", "Account")', // Set the correct action and controller
                        type: 'POST',
                        data: formData,
                        success: function (response) {
                            if (response.success) {
                                // Redirect to a new page on successful registration
                                window.location.href = response.redirectUrl;
                            } else {
                                // Handle validation errors and update the validation summary
                                var validationSummary = $('.validation-summary-valid');
                                validationSummary.html(''); // Clear previous errors
                                $.each(response.errors, function (key, value) {
                                    validationSummary.append('<li>' + value + '</li>');
                                });
                            }
                        },
                        error: function (xhr, status, error) {
                            console.error('An error occurred: ' + error);
                        }
                    });
                }
            });
        });

    </script>
}